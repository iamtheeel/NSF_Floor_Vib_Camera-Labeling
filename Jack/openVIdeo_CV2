####
#Jack Capito
#STARS Summer 2025
#Dr J Lab
###
#opens a video file in CV2
####

import cv2 # pip install opencv-python
import time

dir = r'C:\Users\notyo\Documents\STARS\StudentData\25_06_03\Subject_2'
file = 's2_B8A44FC4B25F_6-3-2025_4-00-20 PM.asf'
filename = f"{dir}/{file}" # Path to the video file
print(filename)

videoObject = cv2.VideoCapture(filename) # Open the video file
if not videoObject.isOpened():
    print("Error: Could not open video file.")
    exit()
print(f"Loaded: {filename}")

fps = videoObject.get(cv2.CAP_PROP_FPS) # Get the frames per second of the video
vidHeight = videoObject.get(cv2.CAP_PROP_FRAME_HEIGHT) # Get the height of the video
vidWidth = videoObject.get(cv2.CAP_PROP_FRAME_WIDTH) # Get the width of the video
frameCount = videoObject.get(cv2.CAP_PROP_FRAME_COUNT) # Get the total number of frames in the video


print(f"Loaded: {filename}, FramesPerS: {fps}hz, Height: {vidHeight}px, Width: {vidWidth}px, FramesTot: {frameCount}frames")

dispFact=2
displayRez = (int(vidWidth/dispFact), int(vidHeight/dispFact)) # Calculate the display resolution by dividing the width and height by a factor


for i in range(int(frameCount)): 
    print(f"load frame {i}")
    start_time = time.time()  # Start timing

    success, frame = videoObject.read() # .read() returns a boolean value and the frame itself. 
                                        #success (t/f): did the frame read successfull?
                                        #frame: the video image
    #check to see if we actually loaded a frame
    if not success:
        print(f"frame read failure")
        exit()

    lwresframe = cv2.resize(frame, displayRez) # Resize the frame to the display resolution
    cv2.imshow("Video Frame", lwresframe) # Display the frame in a window named "Video Frame"

    processing_time = (time.time() - start_time) * 1000  # in milliseconds
    delay = max(int(1000/fps) - int(processing_time), 1)  # Ensure at least 1 ms delay

    print(f"Processing time: {processing_time:.2f} ms, Delay: {delay} ms")  # Optional: see timing info

    # stop the clock
    key = cv2.waitKey(delay) # Wait for a key press for a duration based on the video's FPS
    if key == ord('q') & 0xFF: exit() # If the 'q' key is pressed, exit the loop
